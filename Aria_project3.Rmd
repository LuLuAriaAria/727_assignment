---
title: "Aria_project3"
author: "Aria"
date: "2023-09-19"
output: 
  html_document: 
    toc: yes
---
### 0.The required packages are:
```{r}
library("MASS")
library("stargazer")
library("tidyverse")
```

### A.Examine crim with summary() and in a histogram.
```{r,results='asis'}
Boston <- MASS::Boston
sum <- summary(Boston$crim)
sum
```

```{r,results='hide'}

output <- Boston[c("crim")] %>% stargazer(type = "html",column.sep.width = "20pt")

```

```{r,results='asis'}

# A tidier format could be:
output[2] <- stringr::str_replace(
  output[2], 
  "text-align:center", 
  "text-align:center; width:100%;"
)
cat(output)

```

Visualization:
```{r}
his <- hist(Boston$crim)
his

# A more beautiful plot could be generated by ggplot2:
his_plot <- Boston %>%
  ggplot(aes(x = crim)) +
  geom_histogram( binwidth=10, fill="#69b3a2", color="#e9ecef", alpha=0.9) 

his_plot
```

### B. Focus on suburbs with the crime rate above 25.  
#### How many suburbs fall into this group?  
```{r}
suburbs_25 <- Boston %>%
                filter(crim > 25) %>%
                length()
suburbs_25
```
Therefore, there are 14 suburbs fall into the group whose crime rate is above 25.

#### What are the pupil-teacher ratios like in those suburbs?  
```{r}
pt_ratio <- Boston %>%
                filter(crim > 25) %>%
                select(ptratio) %>%
                summary(ptratio)
pt_ratio
```

#### How about property tax rates?  
```{r}
prpt_rates <- Boston %>%
                filter(crim > 25) %>%
                select(tax) %>%
                summary("tax")
prpt_rates
```

#### How about median home values? 
```{r}
medv <- Boston %>%
                filter(crim > 25) %>%
                select(medv) %>%
                summary("medv")
medv
```

#### How do the pupil-teacher ratios, property tax rates and median home values compare between these suburbs and the remaining suburbs?
```{r}
Boston_new <- Boston %>%
                mutate(group = ifelse(crim >25, 1, 0))

# Normality test:
ptratio_new <- Boston_new %>%
                filter(group == 1)

# weird: why all values in ptratio are identical?
```

### C. Create a scatter plot of the _crime rates_ and the _median home values_ for. 
#### 1) all suburbs,  

```{r}
scat_plot_all <- Boston %>%
                ggplot(aes(x = crim, y = medv)) +
                geom_point(size = 1, colour = 2, alpha = 0.7) 
scat_plot_all
                  
```

#### 2)suburbs bounding Charles River, and  
```{r}
scat_plot_cr <- Boston %>%
                filter(chas == 1) %>%
                ggplot(aes(x = crim, y = medv)) +
                geom_point(size = 1, colour = 3, alpha = 0.7) 
scat_plot_cr
```

#### 3) suburbs not bounding Charles River.  
```{r}
scat_plot_ncr <- Boston %>%
                filter(chas == 0) %>%
                ggplot(aes(x = crim, y = medv)) +
                geom_point(size = 1, colour = 4, alpha = 0.7) 
scat_plot_ncr
```

#### What do you observe?
```{r}
# How to combine these plots together?
```

### D. Analyze the crime rates as a function of median home values in a simple linear regression with an intercept. Report what the regression coefficients mean in lay terms.
```{r,results='asis'}
res_reg <- lm(data = Boston, medv~crim)
stargazer(res_reg, type = "html")
```

For every unit increase in the crime rate, the average house price will decrease by 0.415 units.

### E. Calculate the coefficients reported in D as well as their standard errors by hand.
Considering:

$cov(X,Y) = \frac{(x_i-\bar{x})(y_i-\bar{y})}{N}$

```{r}
cov_reg <- function(data,colname1,colname2){
    i= 1
    for(i in seq_along({{data$colname1}})){
      x <- {{data$colname1}}[[i]]-mean({{data$colname1}})
    }
    for(j in seq_along({{data$colname2}})){
      y <- {{data$colname2}}[[j]]-mean({{data$colname2}})
    } 
    cov <- x*y/length(data)
    return(cov)
}

cov_reg(Boston,medv,crim)

```

### F. Create a scatter plot of the crime rates and the median home values with a regression line. Is the regression line a good summary of the crime rates? Examine residuals to assess this.
```{r}
scat_plot_reg <- Boston %>%
                ggplot(aes(crim,medv)) +
                geom_point(size = 1, colour = 4, alpha = 0.7) +
                stat_smooth(method = "lm",
                            formula = medv ~ crim,
                           geom = "smooth")
scat_plot_reg
```

### G. Create a scatter plot of predicted crim and residuals. What do you observe?